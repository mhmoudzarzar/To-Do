<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To-Do App</title>
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f2f5;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        font-size: 16px;
        color: #333;
    }
    header {
        background-color: #4CAF50;
        color: #fff;
        width: 100%;
        padding: 20px 0;
        text-align: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    header h1 { font-size: 2rem; letter-spacing: 1px; }
    nav {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }
    nav button {
        padding: 8px 18px;
        border: none;
        border-radius: 25px;
        background-color: #4CAF50;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
    }
    nav button:hover { background-color: #45a049; transform: scale(1.05); }
    main { margin-top: 25px; width: 90%; max-width: 600px; display: flex; flex-direction: column; gap: 20px; }

    /* شريط النسبة */
    #progressContainer {
        width: 100%; margin-bottom: 15px;
    }
    #progressContainer label { font-weight: 600; }
    #progressBarBackground {
        background-color: #ddd; border-radius: 20px; overflow: hidden; height: 20px; margin-top: 5px;
    }
    #progressBar {
        height: 100%; width: 0%; background-color: #4CAF50; text-align: center;
        color:white; line-height: 20px; font-size:0.8rem; transition: width 0.3s;
    }

    .task-input-container { display: flex; gap: 10px; flex-wrap: wrap; }
    input[type="text"] {
        flex: 1 1 60%;
        padding: 12px 15px;
        border: 1px solid #ccc;
        border-radius: 25px;
        font-size: 1rem;
        transition: border-color 0.3s;
    }
    input[type="text"]:focus { outline: none; border-color: #4CAF50; }
    button.add {
        flex: 1 1 30%;
        padding: 12px 20px;
        border-radius: 25px;
        background-color: #4CAF50;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
    }
    button.add:hover { background-color: #45a049; transform: scale(1.05); }

    ul { list-style-type: none; padding: 0; display: flex; flex-direction: column; gap: 12px; }
    li {
        background-color: #fff;
        padding: 15px 20px;
        border-radius: 15px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        cursor: grab;
        transition: background-color 0.3s, transform 0.2s;
    }
    li:hover { transform: translateY(-2px); }
    li span { font-size: 1rem; flex: 1 1 auto; word-break: break-word; }
    .buttondiv { display: flex; gap: 8px; flex-wrap: wrap; }
    .buttondiv button {
        padding: 6px 12px;
        border-radius: 20px;
        border: none;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background-color 0.3s, transform 0.2s;
    }
    .buttondiv button:hover { transform: scale(1.05); }
    .buttondiv button:nth-child(1) { background-color: #28a745; color: white; }
    .buttondiv button:nth-child(1):hover { background-color: #218838; }
    .buttondiv button:nth-child(2) { background-color: #ffc107; color: #212529; }
    .buttondiv button:nth-child(2):hover { background-color: #e0a800; }
    .buttondiv button:nth-child(3) { background-color: #dc3545; color: white; }
    .buttondiv button:nth-child(3):hover { background-color: #c82333; }

    li.completed { text-decoration: line-through; background-color: #d4edda; color: #155724; font-style: italic; opacity: 0.7; }
    .task-time { font-size:0.8rem; color:#555; margin-top:5px; }

    footer { margin-top: auto; padding: 15px 0; width: 100%; text-align: center; background-color: #4CAF50; color: white; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); }

    @media (max-width: 480px) {
        body { font-size: 14px; }
        nav button { flex: 1 1 100%; }
        .task-input-container { flex-direction: column; }
        input[type="text"], button.add { flex: 1 1 100%; }
        li { flex-direction: column; align-items: flex-start; }
        .buttondiv { width: 100%; justify-content: flex-start; margin-top: 10px; }
    }
</style>
</head>
<body>
<header><h1>To-Do App</h1></header>
<nav>
    <button id="allBtn">All Tasks</button>
    <button id="activeBtn">Active Tasks</button>
    <button id="completedBtn">Completed Tasks</button>
</nav>

<main>
    <!-- Progress Bar -->
    <div id="progressContainer">
        <label for="progressBar">Progress:</label>
        <div id="progressBarBackground">
            <div id="progressBar">0%</div>
        </div>
    </div>

    <section>
        <div class="task-input-container">
            <input type="text" id="taskInput" placeholder="Enter a new task">
            <button class="add" id="addTaskButton">Add Task</button>
        </div>
        <ul id="taskList"></ul>
    </section>
</main>

<footer>&copy; 2024 To-Do App</footer>

<script>
const taskInput = document.getElementById('taskInput');
const addTaskButton = document.getElementById('addTaskButton');
const taskList = document.getElementById('taskList');
const allBtn = document.getElementById('allBtn');
const activeBtn = document.getElementById('activeBtn');
const completedBtn = document.getElementById('completedBtn');
const progressBar = document.getElementById('progressBar');

class Task {
    constructor(name, id=null, completed=false, createdAt=null, completedAt=null){
        this.name = name;
        this.id = id || Math.floor(Math.random()*10000);
        this.completed = completed;
        this.createdAt = createdAt || new Date().toLocaleString();
        this.completedAt = completedAt || null;
    }

    createTask(){
        const taskItem = document.createElement('li');
        taskItem.id = this.id;
        taskItem.draggable = true;

        const taskTextSpan = document.createElement('span');
        taskTextSpan.textContent = this.name;
        taskItem.appendChild(taskTextSpan);

        const timeSpan = document.createElement('div');
        timeSpan.className = 'task-time';
        timeSpan.textContent = `Created: ${this.createdAt}` + (this.completedAt ? ` | Completed: ${this.completedAt}` : '');
        taskItem.appendChild(timeSpan);

        const buttonDiv = document.createElement('div');
        buttonDiv.className = 'buttondiv';

        const completeButton = document.createElement('button');
        completeButton.textContent = this.completed ? 'Undo' : 'Complete';
        completeButton.addEventListener('click', () => this.toggleComplete(taskItem, completeButton, timeSpan));
        buttonDiv.appendChild(completeButton);

        const editButton = document.createElement('button');
        editButton.textContent = 'Edit';
        editButton.addEventListener('click', () => this.edit(taskTextSpan));
        buttonDiv.appendChild(editButton);

        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.addEventListener('click', () => this.delete(taskItem));
        buttonDiv.appendChild(deleteButton);

        taskItem.appendChild(buttonDiv);
        this.updateTaskStyle(taskItem);
        taskList.appendChild(taskItem);
        updateProgress();
    }

    toggleComplete(taskItem, button, timeSpan){
        this.completed = !this.completed;
        if(this.completed) this.completedAt = new Date().toLocaleString();
        else this.completedAt = null;
        button.textContent = this.completed ? 'Undo' : 'Complete';
        timeSpan.textContent = `Created: ${this.createdAt}` + (this.completedAt ? ` | Completed: ${this.completedAt}` : '');
        this.updateTaskStyle(taskItem);
        saveToLocalStorage();
        updateProgress();
    }

    updateTaskStyle(taskItem){
        if(this.completed) taskItem.classList.add('completed');
        else taskItem.classList.remove('completed');
    }

    delete(taskItem){
        taskItem.remove();
        let taskArray = JSON.parse(localStorage.getItem('taskArray')) || [];
        taskArray = taskArray.filter(t => t.id !== this.id);
        localStorage.setItem('taskArray', JSON.stringify(taskArray));
        updateProgress();
    }

    edit(taskTextSpan){
        const newName = prompt("Edit task name:", this.name);
        if(!newName || /^[0-9]+$/.test(newName)) { alert('Please enter a valid task.'); return; }
        this.name = newName;
        taskTextSpan.textContent = newName;
        saveToLocalStorage();
    }
}

// حفظ وترتيب المهام في localStorage
function saveToLocalStorage(){
    const items = taskList.querySelectorAll('li');
    const taskArray = [];
    items.forEach(li => {
        const spans = li.querySelectorAll('span, .task-time');
        const taskData = {
            id: parseInt(li.id),
            name: spans[0].textContent,
            completed: li.classList.contains('completed'),
            createdAt: spans[1].textContent.match(/Created: (.+?)( \| Completed:|$)/)[1],
            completedAt: spans[1].textContent.includes('Completed:') ? spans[1].textContent.match(/Completed: (.+)/)[1] : null
        };
        taskArray.push(taskData);
    });
    localStorage.setItem('taskArray', JSON.stringify(taskArray));
}

// تحديث شريط النسبة
function updateProgress(){
    const taskArray = JSON.parse(localStorage.getItem('taskArray')) || [];
    if(taskArray.length === 0){ progressBar.style.width='0%'; progressBar.textContent='0%'; return; }
    const completedCount = taskArray.filter(t => t.completed).length;
    const percent = Math.round((completedCount / taskArray.length)*100);
    progressBar.style.width = percent + '%';
    progressBar.textContent = percent + '%';
}

// تحميل المهام عند الصفحة
window.addEventListener('load', () => {
    const taskArray = JSON.parse(localStorage.getItem('taskArray')) || [];
    taskArray.forEach(t => {
        const task = new Task(t.name, t.id, t.completed, t.createdAt, t.completedAt);
        task.createTask();
    });
    updateProgress();
});

// إضافة مهمة جديدة
addTaskButton.addEventListener('click', () => {
    const text = taskInput.value.trim();
    if(!text || /^[0-9]+$/.test(text)){ alert('Please enter a valid task.'); return; }
    const task = new Task(text);
    task.createTask();
    taskInput.value = '';
    saveToLocalStorage();
});

// أزرار الفلتر
allBtn.addEventListener('click', () => filterTasks('all'));
activeBtn.addEventListener('click', () => filterTasks('active'));
completedBtn.addEventListener('click', () => filterTasks('completed'));

function filterTasks(type){
    const items = taskList.querySelectorAll('li');
    items.forEach(li=>{
        const taskArray = JSON.parse(localStorage.getItem('taskArray')) || [];
        const taskData = taskArray.find(t=>t.id == li.id);
        if(!taskData) return;
        if(type==='all') li.style.display='flex';
        else if(type==='active') li.style.display=taskData.completed?'none':'flex';
        else if(type==='completed') li.style.display=taskData.completed?'flex':'none';
    });
}
</script>
</body>
</html>
